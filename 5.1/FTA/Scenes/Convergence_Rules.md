# 收敛规则大全

介绍自愈目前收敛的几种模式，并用现有的一些通用收敛规则举例说明其用法。 希望收敛规则能满足你各式各样的需求，并且在配置好后，让你会忘了它的存在。

## 1. 异常防御需审批
触发规则后，会打电话通知用户，让用户审批决定是否收敛。 如果超时未审批则会收敛跳过，不处理。 如果 30 分钟内发生相同规则的异常防御事件，会被汇集到同一个收敛事件中。

可用于防御大规模告警的异常，如发布未屏蔽，网络问题，机房故障等等。通过人工判断大量的告警是否需要处理。

- \#13 一系列同业务的进程端口告警(可能发布变更未屏蔽):

同业务 5 分钟内出现 3 条以上进程端口则认为是异常事件需要审批(默认不开启)

- \#14 一系列同机房的单机异常告警:

同机房 2 分钟内出现 10 条以上的 ping/agent/restart 告警则认为是异常事件需要审批

- \#15 一系列同业务的单机异常告警:

同业务 2 分钟内出现 3 条以上的 ping/agent/restart 告警则认为是异常事件需要审批

## 2. 触发通知
触发规则后，不影响处理，发送通知。

可用于配置阀值告知。

## 3. 汇集相关事件
触发规则后，不影响处理，只是把满足收敛规则的告警汇集在一起展示为同一个事件。

在界面上把相关的告警汇集在一起展示，能更好自定义告警间的关联性。

- \#9 掉线可能因为大区内基础告警:

对于在线告警，汇总相同大区内的基础告警

- \#18 归纳同主机的一系列告警:

汇总相同主机 5 分钟内出现的告警

- \#20 归纳同主机的一系列进程端口告警:

汇总相同主机 30 分钟内出现的进程端口告警

## 4. 收敛后处理
与其他收敛规则相反。未触发规则时，配置的告警类型不处理。触发规则后，才开始处理。

可以等告警数量超过一定阀值后才处理告警。 或者一定时间内同时出现 A 告警和 B 告警的时候再开始处理。

## 5. 执行中跳过
触发规则后，如果有满足规则的其他告警正在自愈，或刚结束自愈 5 分钟，则跳过当前告警。

可用于避免重复处理。

- \#12 Ping/Agent 引发的一系列告警:

对于由 ping/agent 告警引发的上层告警，如果 ping/agent 告警在处理中，则收敛

## 6. 执行中等待
触发规则后，如果有满足规则的其他告警正在自愈，则等其他告警自愈完成后再继续处理当前告警。

可用户互斥的告警处理，或有先后顺序依赖的告警处理。

## 7. 成功后跳过
触发规则后，如果有满足规则的其他告警自愈成功，则跳过当前告警。失败的话则继续自愈处理。

可用于实现失败重试。

- \#2 一系列单机异常类告警:

对于相同主机的[ping 超时,上报超时,系统重启,磁盘只读]告警，5 分钟内出现过且自愈成功则收敛

- \#5 一系列处理套餐相同的告警:

对于相同主机相同处理的告警，5 分钟内出现过且自愈成功则收敛

## 8. 成功后跳过，失败时审批
触发规则后，如果有满足规则的其他告警自愈成功，则跳过当前告警。 失败的话则发送审批由用户判断是否继续执行自愈处理。

## 9. 超出后汇总
触发规则后，超出数量的告警将会收敛不处理，并发送汇总通知

如果告警在一定时间内不断出现，超过某个阀值可以认为其有异常，不再自愈，触发通知。
